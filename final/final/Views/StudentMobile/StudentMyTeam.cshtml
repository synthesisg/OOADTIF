
@{
	ViewBag.Title = "StudentMyTeam";
	Layout = "~/Views/Shared/SMobileLayout/_SMobileLayout4.cshtml";
}

	<div class="container" style="width:100%;height :auto;">
		<div class="container" style="margin:1px;text-align:center;color:darkseagreen;">
			1-1HHHH
		</div>
		<div class="container" style="background-color:#ffffff;margin:1px;height :auto;">
			<br /><div style="float:left;">组长：</div><div style="float:left;margin-left:15%">111111111111</div><div style="float:left;margin-left:15%">张三</div><hr /><br />
			<div style="float:left;">组员：</div><div style="float:left;margin-left:15%">111111111111</div><div style="float:left;margin-left:15%">张三</div><hr /><br />
			<div style="float:left;">组员：</div><div style="float:left;margin-left:15%">22222222222</div><div style="float:left;margin-left:15%">网二啊</div><hr />
		</div>
	</div>
	@{
		bool isLeader = false;
		bool isCreateEnd = false;
		if (!isLeader) {
			if (!isCreateEnd) {
				<button onclick="quitGroup()" class="btn btn-default" style="background-color:red;margin-top:20px;float:right">
					退组
				</button>
			}
		}
		else {
			//这里也有和createTeam相同的搜索功能=========================
			if (!isCreateEnd) {
			<div class="container" style="width:100%">
				<div class="container" style="background-color:#ffffff;margin:1px;width:100%">
					<p style="font-weight:bold;height:40px;line-height:40px;display:inline;margin-right:2em">添加成员:</p><br />
				</div>
			</div>
			<form class="bs-example bs-example-form" method="post" action="">
				<div class="container" style="width:100%;height: 190px; overflow:scroll">
					<div class="container" style="background-color:#ffffff;margin:1px;width:100%">
						<table style="width:100%" id="table">
							@for (int i = 0; i < ViewBag.stulist.cnt; i++) {
								<tr>
									<td><input type="checkbox" name="sidlist" value="@ViewBag.stulist.student_id[i]" /></td>
									<td><p>@ViewBag.stulist.account[i]</p></td>
									<td><p>@ViewBag.stulist.name[i]</p></td>
									<td><a onclick="delMember('@ViewBag.stulist.account[i]')">删除</a>
								</tr>
							}
						</table>
					</div>
				</div>
				<div class="container" style="width:100%">
					<div class="container" style="background-color:#ffffff;margin:1px;width:100%">
						<p style="font-weight:bold;height:40px;line-height:40px;display:inline;margin-right:2em">搜索成员:</p>
						<input type="text" name="sear" id="sear" style="width:50%;" />
						<input type="button" class="btn-primary" value="搜索" onclick="searchStudent();">
					</div>
				</div>
				<button type="button" onclick="quitGroup()" class="btn btn-default" style="background-color:red;margin-top:20px;">
					解散小组
				</button>
				<button type="submit" class="btn btn-default" style="margin-top:20px;">
					保存修改
				</button>
			</form>
			}
		}
	}

<script>
	function quitGroup() {
		if (confirm("确认退出组队吗？")) {
			$.ajax({
				'url': "",
				'type': "post",
				success: function () {
					alert("退出组队成功");
					window.location.reload();
				},
				error: function () {
					alert("操作失败！");
				}
			})
		}
	}
	function delMember(account) {
		if (confirm("确认删除该成员吗？")) {
			$.ajax({
				'url': "",
				'type': "post",
				'data': { account, account },
				success: function () {
					alert("删除成功");
					window.location.reload();
				}
			})
		}
	}
	 function searchStudent()
    {
        var sid = document.getElementById("sear").value;
        //if (sid != "")
        {
            $.ajax({
                'url': "/StudentMobile/search",
                'type': "post",
                'data': { sid: sid, cid:'@ViewBag.course_id'},
                success: function (mes)
				{
					
					var jobj = eval("(" + mes + ")");
					var table = document.getElementById("table");
					//遍历删除未选中
					var count;
					for (count = 0; count < table.rows.length;) {
						var cbox = table.rows[count].cells[0].childNodes[0];
						if (!cbox.checked) {
							table.rows[count].remove();
						}
						else
							count++;
					}
                    for (var i = 0; i < jobj.cnt;i++) {
						var flag = true;
						for (var j = 0; j < table.rows.length; j++) {
							if (jobj.student_id[i] == table.rows[j].cells[0].childNodes[0].value) {
								flag = false;
							}
						}
						if (flag) {
							var row = table.insertRow(count);
							var cell = row.insertCell(0);
							cell.innerHTML = "<td><p>" + jobj.name[i] + "</p></td>";
							cell = row.insertCell(0);
							cell.innerHTML = "<td><p>" + jobj.account[i] + "</p></td>";
							cell = row.insertCell(0);
                            cell.innerHTML = "<td><input type='checkbox' name='sidlist' value=" + jobj.student_id[i] + " /></td>";
						}
                    }
                },
                error: function () { alert('error');}
            })
        }
    }
</script>
